<div class="h-full w-full flex flex-col">

  <!-- Header -->
  <header class="w-full bg-neutral-800 shadow flex items-center px-4 py-2">
    <div class="flex items-center space-x-2">
      <img class="h-8" src="../../../assets/images/logo.png" alt="Logo">
      <h1 class="flex flex-col text-sm text-white font-bold leading-tight">
        <span>Traveller's{{" "}}</span>
        <span>Friend</span>
      </h1>
    </div>
    <div class="ml-auto flex items-center space-x-2">
      <button class="menu-item px-3 py-1 rounded-md bg-transparent text-white font-bold text-sm hover:bg-neutral-900"
        (click)="openAboutModal()">
        About
      </button>
    </div>
    @if (isLoadingData) {
    <div class="absolute bottom-0 left-0 w-full">
      <div class="h-1 bg-gradient-to-r from-orange-500 via-yellow-400 to-green-500 animate-pulse"></div>
    </div>
    }
  </header>

  <!-- Main Content -->
  <main class="relative w-full flex-1">
    <div class="h-full w-full">
      <app-map (markerClicked)="openModal($event)" (openSettingsModal)="openSettingsModal()"></app-map>
    </div>

    <div class="absolute top-4 right-4">
      @if (tileMode === 0) {
      <img (click)="tileLayerChanged(1)"
        class="h-14 w-14 object-cover border-2 border-black cursor-pointer rounded-lg mb-1"
        src="../../../assets/images/default-tiles.png" />
      }

      @if (tileMode === 1) {
      <img (click)="tileLayerChanged(0)"
        class="h-14 w-14 object-cover border-2 border-black cursor-pointer rounded-lg mb-1"
        src="../../../assets/images/satelite-tiles.png" />
      }
    </div>

    <div class="fixed bottom-8 right-8">
      <button class="rounded-full bg-traveller text-white p-4 shadow-lg hover:bg-traveller-shade transition"
        (click)="openSettingsModal()">
        <lucide-icon [img]="filterIcon"></lucide-icon>
      </button>
    </div>

    <app-popup [show]="modalIsOpen" (close)="modalIsOpen = false" [title]="heading" [class]="modalClass">
      <app-details-popup [tags]="tags" [nodeId]="nodeId"></app-details-popup>
    </app-popup>

    <app-popup [show]="isSettingsModalOpen" (close)="isSettingsModalOpen = false" title="Filter">
      <div class="flex flex-col space-y-2 mt-4">
        <ng-container *ngFor="let category of categories">
          <button type="button" (click)="toggleSetting(category.key)"
            class="flex items-center justify-between w-full p-2 rounded-lg border transition" [ngClass]="
            settings[category.key]
              ? category.color + ' border-transparent text-white'
              : 'border-neutral-600 text-white'
          ">
            <span>{{ category.label }}</span>
            <div
              class="w-5 h-5 rounded-full border-2 border-gray-300 flex-shrink-0 flex items-center justify-center transition"
              [ngClass]="settings[category.key] ? category.color : 'bg-neutral-800'">
              <div *ngIf="settings[category.key]" class="w-3 h-3 rounded-full bg-white"></div>
            </div>
          </button>
        </ng-container>
      </div>
    </app-popup>

    <app-popup [show]="isAboutModalOpen" (close)="isAboutModalOpen = false" title="About">
      <p class="mt-4">
        Travellers Friend was created during the
        <a href="https://digitaleinitiativen.at/initiativen/ummahuesla-hackathon/" target="_blank"
          class="text-traveller font-bold underline">Umma HÃ¼sla Hackathon</a>
        2022 by Daniel, Mathias and Jakob.
      </p>
      <p class="mt-2">
        The source code is available on
        <a href="https://github.com/daniebeler/travellers-friend" target="_blank"
          class="text-traveller font-bold underline">Github</a>.
      </p>
    </app-popup>

  </main>
</div>
